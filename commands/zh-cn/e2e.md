---
description: 使用 Playwright 生成并运行端到端测试。创建测试路径、运行测试、捕获截图/视频/追踪并上传产物。
---

# E2E 命令

此命令调用 **e2e-runner** 代理，使用 Playwright 生成、维护和执行端到端测试。

## 此命令的作用

1. **生成测试路径** - 为用户流程创建 Playwright 测试
2. **运行 E2E 测试** - 在多浏览器上执行测试
3. **捕获产物** - 在失败时捕获截图、视频和追踪 (Traces)
4. **上传结果** - HTML 报告和 JUnit XML
5. **识别不稳定测试** - 隔离不稳定的测试 (Flaky tests)

## 何时使用

在以下情况使用 `/e2e`：
- 测试关键用户路径 (登录、交易、支付)
- 验证多步骤流程的端到端运行情况
- 测试 UI 交互和导航
- 验证前端与后端的集成
- 为生产环境部署做准备

## 工作原理

e2e-runner 代理将会：

1. **分析用户流程** 并识别测试场景
2. **生成 Playwright 测试**，采用页面对象模型 (POM) 模式
3. **在多个浏览器上运行测试** (Chrome, Firefox, Safari)
4. **捕获失败信息**，包含截图、视频和追踪
5. **生成报告**，包含结果和产物Ï
6. **识别不稳定测试** 并建议修复方案

## 使用示例

```
用户：/e2e 测试市场搜索和查看流程

代理 (e2e-runner)：
# E2E 测试生成：市场搜索和查看流程

## 已识别的测试场景

**用户路径：** 市场搜索 → 查看结果 → 点击市场 → 查看详情

**测试覆盖范围：**
1. 导航到市场页面
2. 执行语义搜索
3. 验证搜索结果
4. 点击第一个结果
5. 验证市场详情页加载
6. 验证图表渲染
...
```

## 测试产物

当测试运行时，会捕获以下产物：

**所有测试：**
- 包含时间线和结果的 HTML 报告
- 用于 CI 集成的 JUnit XML

**仅在失败时：**
- 失败状态的截图
- 测试过程的视频录制
- 用于调试的追踪文件 (单步回放)
- 网络日志
- 控制台日志

## 浏览器配置

默认在多个浏览器上运行：
- ✅ Chromium (桌面版 Chrome)
- ✅ Firefox (桌面版)
- ✅ WebKit (桌面版 Safari)
- ✅ 移动端 Chrome (可选)

在 `playwright.config.ts` 中调整浏览器配置。

## 最佳实践

**应该做：**
- ✅ 使用页面对象模型以提高可维护性
- ✅ 使用 data-testid 属性作为定位器
- ✅ 等待 API 响应，而非使用固定时长等待
- ✅ 测试关键用户路径的端到端流程
- ✅ 在合并到主分支前运行测试

**不该做：**
- ❌ 使用脆弱的定位器 (CSS 类名可能会变)
- ❌ 测试实现细节
- ❌ 在生产环境运行测试
- ❌ 忽略不稳定的测试
- ❌ 在失败时不查看产物报告
